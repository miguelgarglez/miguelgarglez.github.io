<section id="experience" class="experience">
  <div class="timeline">
    <div class="timeline-item current">
      <div class="timeline-marker"></div>
      <div class="timeline-content">
        <div class="period">Sep 2024 - Current</div>
        <h3 class="job-title">Frontend UI Platform Engineer</h3>
        <p class="company">Open Digital Services (Santander Group)</p>
        <button class="expand-btn mobile-only" aria-label="Expand details">
          <span class="expand-text">Show more</span>
          <span class="expand-icon">+</span>
        </button>
        <ul class="achievements expandable">
          <li>
            Member of the <strong>Kubit Web UI components platform team</strong>,
            building and maintaining the component library used by web developers
            across <strong>Grupo Santander</strong> banks.
          </li>
          <li>
            Lead implementation, maintenance, and refactoring of UI components,
            ensuring <strong>consistency, performance, and accessibility</strong>
            across the product ecosystem.
          </li>
          <li>
            Contribute to the <strong>open-source charting library</strong>,
            adding new features and continuous improvements.
          </li>
          <li>
            Manage releases with <strong>semantic versioning</strong>, branch
            strategy, and <strong>Storybook documentation</strong>; support
            Kubit's public presence through product landing pages.
          </li>
          <li>
            Drive <strong>AI-enabled workflows</strong> with tools like GitHub
            Copilot, MCP servers, and context engineering to improve productivity,
            code quality, and collaborative development.
          </li>
        </ul>
      </div>
    </div>

    <div class="timeline-item">
      <div class="timeline-marker"></div>
      <div class="timeline-content">
        <div class="period">Sep 2023 - Jul 2024</div>
        <h3 class="job-title">QA Software Engineer</h3>
        <p class="company">Jember Engineering Solutions</p>
        <button class="expand-btn mobile-only" aria-label="Expand details">
          <span class="expand-text">Show more</span>
          <span class="expand-icon">+</span>
        </button>
        <ul class="achievements expandable">
          <li>
            Work and coordinate with <strong
              >app frontend development team</strong
            > with <strong>agile methodologies</strong>, ensuring that the
            different parties are aligned to successfully complete the
            development of new features.
          </li>
          <li>
            Report <strong>hundreds of bugs</strong>, leading to noticeable
            improvements on app's <strong>performance and UX</strong>.
          </li>
          <li>
            Working together with another QA to <strong
              >refactor and relaunch a test automation project</strong
            > for the company apps that had been abandoned for more than 2 years,
            leading to an improvement of <strong
              >50% in cost of person days</strong
            > for regression tests.
          </li>
        </ul>
      </div>
    </div>

    <div class="timeline-item">
      <div class="timeline-marker"></div>
      <div class="timeline-content">
        <div class="period">Jan 2022 - May 2022</div>
        <h3 class="job-title">Software Developer</h3>
        <p class="company">Electric-Save</p>
        <button class="expand-btn mobile-only" aria-label="Expand details">
          <span class="expand-text">Show more</span>
          <span class="expand-icon">+</span>
        </button>
        <ul class="achievements expandable">
          <li>
            Attend <strong>clients directly</strong> (was a <strong
              >B2B startup company</strong
            >), reporting and fixing errors with the software provided by the
            company, contributing to <strong>customer satisfaction</strong> and continuity
            using the company's software product.
          </li>
          <li>
            Create a <strong>web application</strong> to make a <strong
              >proof of concept</strong
            > to an important potential client, which took our proposal to the
            <strong>next stage of selection</strong>.
          </li>
          <li>
            Run <strong>remote meetings</strong> to show the software product to
            new potential clients, leading to new challenges and <strong
              >growth of the company</strong
            >.
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener('DOMContentLoaded', () => {
    // Establecer estado inicial para todos los elementos animados
    gsap.set('#experience .section-title', { y: 50, opacity: 0 });
    gsap.set('#experience .timeline-item', { x: -100, opacity: 0 });
    gsap.set('#experience .timeline-marker', { scale: 0 });

    // Animación del título
    gsap.to('#experience .section-title', {
      y: 0,
      opacity: 1,
      duration: 1,
      ease: 'power2.out',
      scrollTrigger: {
        trigger: '#experience',
        start: 'top 70%',
        end: 'bottom 70%',
        toggleActions: 'play none none reverse',
      },
    });

    // Animación de los elementos del timeline
    gsap.to('#experience .timeline-item', {
      x: 0,
      opacity: 1,
      duration: 0.8,
      stagger: 0.2,
      ease: 'power2.out',
      scrollTrigger: {
        trigger: '#experience .timeline',
        start: 'top 80%',
        end: 'bottom 80%',
        toggleActions: 'play none none reverse',
      },
    });

    // Animación de los markers
    gsap.to('#experience .timeline-marker', {
      scale: 1,
      duration: 0.5,
      stagger: 0.2,
      ease: 'back.out(1.7)',
      scrollTrigger: {
        trigger: '#experience .timeline',
        start: 'top 80%',
        end: 'bottom 80%',
        toggleActions: 'play none none reverse',
      },
    });
  });

  // Funcionalidad para botones expandibles en móvil
  document.addEventListener('DOMContentLoaded', () => {
    const expandBtns = document.querySelectorAll('.expand-btn');

    expandBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        const achievements = btn.nextElementSibling;
        const expandText = btn.querySelector('.expand-text');
        const expandIcon = btn.querySelector('.expand-icon');
        if (!expandText) return;
        if (!expandIcon) return;
        if (!achievements) return;
        const isExpanded = achievements.classList.contains('expanded');

        if (isExpanded) {
          achievements.classList.remove('expanded');
          btn.classList.remove('expanded');
          expandText.textContent = 'Show more';
          expandIcon.textContent = '+';
        } else {
          achievements.classList.add('expanded');
          btn.classList.add('expanded');
          expandText.textContent = 'Show less';
          expandIcon.textContent = '-';
        }
      });
    });
  });
</script>

<style>
  .experience {
    padding: 5rem 2rem;
    background: var(--bg-light);
    color: var(--text);
    overflow: hidden;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
  }

  .section-title {
    font-size: clamp(2rem, 4vw, 3rem);
    text-align: center;
    margin-bottom: 4rem;
    color: var(--text);
    font-weight: 700;
  }

  .timeline {
    position: relative;
    padding-left: 3rem;
    max-width: 980px;
    margin: 0 auto;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 1.5rem;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(180deg, transparent 0%, var(--border) 12%, var(--border) 88%, transparent 100%);
  }

  .timeline-item {
    position: relative;
    margin-bottom: 3rem;
    padding-left: 2rem;
  }

  .timeline-marker {
    position: absolute;
    left: -2.18rem;
    top: 0.5rem;
    width: 1rem;
    height: 1rem;
    background: var(--bg);
    border-radius: 50%;
    border: 3px solid var(--primary);
    box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);
    z-index: 1;
  }

  .timeline-content {
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0) 100%);
    padding: 2rem;
    border-radius: 16px;
    border: 1px solid var(--border-muted);
    box-shadow: 0 14px 40px rgba(0, 0, 0, 0.12);
    transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
  }

  .timeline-content:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    border-color: var(--primary);
  }

  .timeline-item.current .timeline-content {
    border-color: rgba(255, 171, 45, 0.45);
    box-shadow: 0 18px 50px rgba(255, 171, 45, 0.12);
  }

  .timeline-item.current .timeline-content:hover {
    border-color: var(--primary);
    box-shadow: 0 22px 60px rgba(255, 171, 45, 0.18);
  }

  .timeline-item.current .timeline-marker {
    background: var(--primary);
    box-shadow: 0 0 0 6px rgba(255, 171, 45, 0.18);
  }

  .timeline-item.current .period {
    border-color: rgba(255, 171, 45, 0.45);
    background: rgba(255, 171, 45, 0.12);
  }

  body.light .timeline::before {
    background: linear-gradient(180deg, transparent 0%, rgba(176, 106, 6, 0.2) 12%, rgba(176, 106, 6, 0.2) 88%, transparent 100%);
  }

  body.light .timeline-marker {
    background: var(--bg-light);
    border-color: var(--primary);
    box-shadow: none;
  }

  body.light .timeline-content {
    background: var(--bg-light);
    border-color: rgba(176, 106, 6, 0.18);
    box-shadow: 0 16px 40px rgba(97, 70, 33, 0.08);
  }

  body.light .timeline-content:hover {
    box-shadow: 0 20px 50px rgba(97, 70, 33, 0.12);
  }

  body.light .period {
    border-color: rgba(176, 106, 6, 0.25);
    background: rgba(176, 106, 6, 0.08);
  }

  body.light .achievements li::before {
    background: var(--primary);
  }

  body.light .timeline-item.current .timeline-content {
    border-color: rgba(176, 106, 6, 0.35);
    box-shadow: 0 20px 50px rgba(176, 106, 6, 0.14);
  }

  body.light .timeline-item.current .timeline-marker {
    background: var(--primary);
    box-shadow: 0 0 0 8px rgba(176, 106, 6, 0.18);
  }

  .period {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    color: var(--primary);
    border: 1px solid rgba(255, 255, 255, 0.08);
    background: rgba(0, 0, 0, 0.2);
    font-weight: 600;
    font-size: 0.9rem;
    padding: 0.35rem 0.85rem;
    border-radius: 999px;
    margin-bottom: 0.5rem;
  }

  .job-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--text);
    margin: 0 0 0.5rem 0;
  }

  .company {
    color: var(--text-muted);
    font-style: italic;
    margin: 0 0 1.5rem 0;
  }

  .achievements {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .achievements li {
    position: relative;
    padding-left: 1.2rem;
    margin-bottom: 0.8rem;
    line-height: 1.6;
    color: var(--text-muted);
  }

  .achievements li strong {
    color: var(--primary);
    font-weight: 600;
  }

  .achievements li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.55rem;
    width: 0.4rem;
    height: 0.4rem;
    border-radius: 999px;
    background: var(--primary);
  }

  .achievements li:last-child {
    margin-bottom: 0;
  }

  /* Estilos para funcionalidad expandible en móvil */
  .expand-btn {
    display: none;
    background: var(--primary);
    color: var(--bg);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
    align-items: center;
    gap: 0.5rem;
  }

  .expand-btn:hover {
    transform: translateY(-1px);
  }

  .expand-icon {
    transition: all 0.3s ease;
    display: inline-block;
    font-weight: bold;
    font-size: 1rem;
  }

  .expand-btn.expanded .expand-icon {
    transform: rotate(360deg);
  }

  @media (max-width: 768px) {
    .experience {
      padding: 3rem 1rem;
    }

    .timeline {
      padding-left: 2.5rem;
      max-width: 100%;
    }

    .timeline::before {
      left: 1.25rem;
    }

    .timeline-marker {
      left: -1.9rem;
    }

    .timeline-content {
      padding: 1.5rem;
    }

    /* Mostrar botón expandible en móvil */
    .mobile-only {
      display: flex !important;
    }

    /* Ocultar logros por defecto en móvil */
    .achievements.expandable {
      display: none;
      margin-top: 0;
    }

    /* Mostrar cuando está expandido */
    .achievements.expandable.expanded {
      display: block;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }
</style>
